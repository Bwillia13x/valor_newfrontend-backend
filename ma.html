<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valor IVX - M&A Analysis</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .ma-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .ma-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .ma-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .ma-section h3 {
            margin-top: 0;
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .ma-input-group {
            margin-bottom: 15px;
        }
        
        .ma-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .ma-input-group input,
        .ma-input-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 14px;
        }
        
        .ma-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .ma-result-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        
        .ma-result-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .ma-result-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .positive { color: var(--success-color); }
        .negative { color: var(--error-color); }
        
        .ma-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .ma-chart-container {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }
        
        .ma-chart-container h4 {
            margin-top: 0;
            color: var(--accent-color);
        }
        
        .ma-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .ma-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .ma-btn-primary {
            background: var(--accent-color);
            color: white;
        }
        
        .ma-btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .ma-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .ma-progress {
            display: none;
            margin: 20px 0;
        }
        
        .ma-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .ma-progress-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="ma-container">
        <header>
            <h1>M&A Analysis</h1>
            <p>Comprehensive merger and acquisition modeling with accretion/dilution analysis</p>
        </header>

        <div class="ma-grid">
            <!-- Acquirer Information -->
            <div class="ma-section">
                <h3>Acquirer Information</h3>
                <div class="ma-input-group">
                    <label for="acquirer-revenue">Revenue ($M)</label>
                    <input type="number" id="acquirer-revenue" value="1000" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="acquirer-ebitda">EBITDA ($M)</label>
                    <input type="number" id="acquirer-ebitda" value="150" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="acquirer-shares">Shares Outstanding (M)</label>
                    <input type="number" id="acquirer-shares" value="100" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="acquirer-net-debt">Net Debt ($M)</label>
                    <input type="number" id="acquirer-net-debt" value="200" step="0.1">
                </div>
            </div>

            <!-- Target Information -->
            <div class="ma-section">
                <h3>Target Information</h3>
                <div class="ma-input-group">
                    <label for="target-revenue">Revenue ($M)</label>
                    <input type="number" id="target-revenue" value="500" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="target-ebitda">EBITDA ($M)</label>
                    <input type="number" id="target-ebitda" value="75" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="target-shares">Shares Outstanding (M)</label>
                    <input type="number" id="target-shares" value="50" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="target-net-debt">Net Debt ($M)</label>
                    <input type="number" id="target-net-debt" value="100" step="0.1">
                </div>
            </div>

            <!-- Deal Structure -->
            <div class="ma-section">
                <h3>Deal Structure</h3>
                <div class="ma-input-group">
                    <label for="purchase-price">Purchase Price ($M)</label>
                    <input type="number" id="purchase-price" value="600" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="deal-cash">Cash (%)</label>
                    <input type="number" id="deal-cash" value="60" min="0" max="100" step="1">
                </div>
                <div class="ma-input-group">
                    <label for="deal-stock">Stock (%)</label>
                    <input type="number" id="deal-stock" value="40" min="0" max="100" step="1">
                </div>
            </div>

            <!-- Synergies -->
            <div class="ma-section">
                <h3>Synergies</h3>
                <div class="ma-input-group">
                    <label for="synergies-annual">Annual Synergies ($M)</label>
                    <input type="number" id="synergies-annual" value="25" step="0.1">
                </div>
                <div class="ma-input-group">
                    <label for="synergies-duration">Duration (Years)</label>
                    <input type="number" id="synergies-duration" value="5" min="1" max="20" step="1">
                </div>
                <div class="ma-input-group">
                    <label for="synergies-type">Synergy Type</label>
                    <select id="synergies-type">
                        <option value="cost">Cost Synergies</option>
                        <option value="revenue">Revenue Synergies</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="ma-actions">
            <button class="ma-btn ma-btn-primary" id="run-ma-analysis">Run M&A Analysis</button>
            <button class="ma-btn ma-btn-secondary" id="reset-ma">Reset</button>
            <button class="ma-btn ma-btn-secondary" id="export-ma">Export Results</button>
        </div>

        <!-- Progress Bar -->
        <div class="ma-progress" id="ma-progress">
            <div class="ma-progress-bar">
                <div class="ma-progress-fill" id="ma-progress-fill"></div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="ma-section" id="ma-results-section" style="display: none;">
            <h3>Analysis Results</h3>
            
            <!-- Pro Forma Results -->
            <h4>Pro Forma Financials</h4>
            <div class="ma-results">
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-proforma-revenue">$0M</div>
                    <div class="ma-result-label">Pro Forma Revenue</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-proforma-ebitda">$0M</div>
                    <div class="ma-result-label">Pro Forma EBITDA</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-proforma-eps">$0</div>
                    <div class="ma-result-label">Pro Forma EPS</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-proforma-shares">0M</div>
                    <div class="ma-result-label">Pro Forma Shares</div>
                </div>
            </div>

            <!-- Accretion/Dilution -->
            <h4>Accretion/Dilution Analysis</h4>
            <div class="ma-results">
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-accretion-dilution">0%</div>
                    <div class="ma-result-label">Accretion/Dilution</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-target-contribution">$0</div>
                    <div class="ma-result-label">Target Contribution</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-synergy-contribution">$0</div>
                    <div class="ma-result-label">Synergy Contribution</div>
                </div>
            </div>

            <!-- Deal Metrics -->
            <h4>Deal Metrics</h4>
            <div class="ma-results">
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-ev-ebitda">0.0x</div>
                    <div class="ma-result-label">EV/EBITDA Multiple</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-ev-revenue">0.0x</div>
                    <div class="ma-result-label">EV/Revenue Multiple</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-roic">0%</div>
                    <div class="ma-result-label">ROIC</div>
                </div>
            </div>

            <!-- Synergies -->
            <h4>Synergy Analysis</h4>
            <div class="ma-results">
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-synergies-pv">$0M</div>
                    <div class="ma-result-label">PV of Synergies</div>
                </div>
                <div class="ma-result-card">
                    <div class="ma-result-value" id="ma-synergies-per-share">$0</div>
                    <div class="ma-result-label">Synergies per Share</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="ma-charts" id="ma-charts-section" style="display: none;">
            <div class="ma-chart-container">
                <h4>Accretion/Dilution Analysis</h4>
                <canvas id="ma-accretion-chart" width="400" height="300"></canvas>
            </div>
            <div class="ma-chart-container">
                <h4>Pro Forma Comparison</h4>
                <canvas id="ma-proforma-chart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>

    <script type="module">
        import { maEngine } from './js/modules/ma-engine.js';
        import { $, fmt } from './js/modules/utils.js';

        // Initialize M&A analysis
        function initializeMA() {
            // Set up event listeners
            $('#run-ma-analysis').addEventListener('click', runMAAnalysis);
            $('#reset-ma').addEventListener('click', resetMA);
            $('#export-ma').addEventListener('click', exportMAResults);

            // Set up input validation
            setupInputValidation();
        }

        // Run M&A analysis
        async function runMAAnalysis() {
            try {
                // Show progress
                $('#ma-progress').style.display = 'block';
                $('#ma-progress-fill').style.width = '0%';

                // Get input parameters
                const params = getMAInputs();

                // Run analysis
                const results = await maEngine.runAnalysis(params);

                // Update UI
                maEngine.updateUI();
                $('#ma-results-section').style.display = 'block';
                $('#ma-charts-section').style.display = 'block';

                // Hide progress
                $('#ma-progress').style.display = 'none';

                console.log('M&A Analysis completed:', results);

            } catch (error) {
                console.error('M&A Analysis error:', error);
                alert('Error running M&A analysis: ' + error.message);
                $('#ma-progress').style.display = 'none';
            }
        }

        // Get M&A inputs
        function getMAInputs() {
            return {
                acquirerRevenue: parseFloat($('#acquirer-revenue').value),
                acquirerEBITDA: parseFloat($('#acquirer-ebitda').value),
                acquirerShares: parseFloat($('#acquirer-shares').value),
                acquirerNetDebt: parseFloat($('#acquirer-net-debt').value),
                targetRevenue: parseFloat($('#target-revenue').value),
                targetEBITDA: parseFloat($('#target-ebitda').value),
                targetShares: parseFloat($('#target-shares').value),
                targetNetDebt: parseFloat($('#target-net-debt').value),
                purchasePrice: parseFloat($('#purchase-price').value),
                dealStructure: {
                    cash: parseFloat($('#deal-cash').value),
                    stock: parseFloat($('#deal-stock').value)
                },
                synergies: {
                    annual: parseFloat($('#synergies-annual').value),
                    duration: parseInt($('#synergies-duration').value),
                    type: $('#synergies-type').value
                }
            };
        }

        // Reset M&A form
        function resetMA() {
            const inputs = document.querySelectorAll('.ma-section input');
            inputs.forEach(input => {
                if (input.id === 'acquirer-revenue') input.value = '1000';
                else if (input.id === 'acquirer-ebitda') input.value = '150';
                else if (input.id === 'acquirer-shares') input.value = '100';
                else if (input.id === 'acquirer-net-debt') input.value = '200';
                else if (input.id === 'target-revenue') input.value = '500';
                else if (input.id === 'target-ebitda') input.value = '75';
                else if (input.id === 'target-shares') input.value = '50';
                else if (input.id === 'target-net-debt') input.value = '100';
                else if (input.id === 'purchase-price') input.value = '600';
                else if (input.id === 'deal-cash') input.value = '60';
                else if (input.id === 'deal-stock') input.value = '40';
                else if (input.id === 'synergies-annual') input.value = '25';
                else if (input.id === 'synergies-duration') input.value = '5';
            });

            $('#ma-results-section').style.display = 'none';
            $('#ma-charts-section').style.display = 'none';
        }

        // Export M&A results
        function exportMAResults() {
            try {
                const results = maEngine.exportResults();
                const blob = new Blob([results], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ma-analysis-results.json';
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('No results to export. Please run an analysis first.');
            }
        }

        // Setup input validation
        function setupInputValidation() {
            // Deal structure validation
            $('#deal-cash').addEventListener('input', validateDealStructure);
            $('#deal-stock').addEventListener('input', validateDealStructure);
        }

        // Validate deal structure
        function validateDealStructure() {
            const cash = parseFloat($('#deal-cash').value) || 0;
            const stock = parseFloat($('#deal-stock').value) || 0;
            
            if (cash + stock !== 100) {
                $('#deal-stock').style.borderColor = 'var(--error-color)';
            } else {
                $('#deal-stock').style.borderColor = 'var(--border-color)';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeMA);
    </script>
</body>
</html>